# **25.09.17 리팩토링**

## **주요 리팩토링 내용**

- 레이어트 아키텍처 구조로 패키지 변경
- 메모리로 사용되던 저장소를 DB로 변경
- `Library` 클래스와 `LibraryServiceImpl` 클래스 모두 `Repository`를 호출하는 바람에 저장소가 바뀔 경우 리팩토링 취약
    - → `LibraryServiceImpl` 클래스만 저장소를 호출하도록 리팩토링, `LibraryDAO` 인터페이스 통해 기능 분리
- `void`로 호출되던 많은 메서드가 리팩토링 과정에서 반환값 필요에 의해 메서드 반환값 수정
    - → 반환값 수정 이후 `NullPointerException` 발생 구간 다수 발견되어 오류 처리 필요

## **레이어트 아키텍처 구조로 패키지 변경**

```mathematica
miniproject01/
├── README.md
├── common
│   ├── generator -- BookIdGenerator, MemberIdGenerator, MenuGenerator
│   ├── validator -- BookValidator, MemberValidator
│   └── DBUtil
├── controller -- LibraryMain
├── dto -- Book, Member
├── repository
│   ├── book -- BookRepository, MemoryBookRepository, DataBookRepository
│   ├── library -- LibraryDAO, MemoryLibraryImpl
│   └── member -- MemberRepository, MemoryMemberRepository, DataMemberRepository
└── service
    └── library -- LibraryService, LibraryServiceImpl

```

## **DB (library)**

### **테이블**

- books
    - book_id: BigInt, primary key, auto_increment
    - title: String, not null
    - author: String, not null
    - is_rented: Boolean, default false
- members
    - member_id: BigInt, primary key, auto_increment
    - name: String, not null
    - phone_number: String, not null
    - birth: String
- rented_books
    - book_id: BigInt (FK)
    - member_id: BigInt (FK)

## **TODO**

- 리팩토링 과정에서 미완성된 기능 구현하기
- 회원, 도서 등록 전에 목록 조회 시 / 대여 중인 도서 없는 경우 NPE(NullPointerException 발생) -> 오류 해결하기
- 존재하지 않는 회원 / 도서 검색 시 아무 출력도 발생하지 않고 넘어감 -> 출력문 만들기
- 존재하지 않는 회원 / 도서 대여 시 대여 가능 / 반납 가능 -> 대여 중인 도서 목록에서 null 발생 -> 해결하기

## **FEEDBACK**

- 검증에 대해
    - 비즈니스 규칙(예: 이미 존재하는 회원, 대여 중인 도서)의 경우 대체로 서비스 쪽에서 검증한다.
    - 불변 조건(예: 회원 이름이 공백, 전화번호나 생년월일이 음수)의 경우 대체로 엔티티 쪽에서 검증한다.
    - 메뉴 출력(컨트롤러)은 메인에서 메서드로 뽑는 것도 방법이다.

## **Addition**

- DAO는 오직 데이터베이스에 대한 내용만 담고 있어야 한다.
- 검증을 통해 구현되는 부분은 service로 옮겨지는 것이 필요하다.
- 궁금
    - DB로 auto_increment 를 통해 생성한 후에는 generator 불필요?
