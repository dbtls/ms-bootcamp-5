# 데이터베이스 개요

## Database란?

- 데이터베이스(Database)란 데이터의 집합(a Set of Data)이다.
    - 여러 응용 프로그램들의 통합된 정보들을 저장하여 운영할 수 있는 공용 데이터의 집합
    - 효율적으로 저장, 검색, 갱신할 수 있도록 데이터 집합들끼리 연관시키고 조직화

## 데이터베이스의 특성

| **특징** | **설명** |
| --- | --- |
| **실시간 접근성** | 사용자의 요구를 즉시 처리할 수 있다. |
| **계속적인 변화** | 삽입・삭제・수정으로 데이터를 지속적으로 갱신한다. |
| **동시 공유성** | 여러 사용자가 동시에 같은 데이터에 접근 가능하다. |
| **내용 참조** | 데이터의 위치가 아닌 내용(값)에 따라 참조한다. |

## 데이터베이스의 구조

**테이블 구조 이해하기**

<img width="722" height="289" alt="Image" src="https://github.com/user-attachments/assets/d885ebfd-08f0-43c5-809b-450a294fd87d" />

- 각 행은 한 명의 학생 정보를 담고 있다.
- student_id는 기본키(Primary_Key)로 각 학생을 고유하게 식별한다.
- name, grade, dept는 학생의 속성 정보이다.

**데이터베이스의 기본 구성 요소**

- **테이블(Table)**: 데이터를 저장하는 기본 단위
- **행(Row/Record)**: 하나의 데이터 항목 (예: 한 명의 학생 정보)
- **열(Column/Field)**: 데이터의 속성 (예: 이름, 학번, 학과)
- **키(Key)**: 각 행을 고유하게 식별하는 값

## DBMS (Database Management System)

- 데이터베이스를 관리하는 소프트웨어로 다음과 같은 필수 기능을 제공한다.
    - **정의 기능**: 데이터베이스의 논리적, 물리적 구조를 정의
    - **조작 기능**: 데이터를 검색, 삭제, 갱신, 삽입하는 기능
    - **제어 기능**: 데이터베이스의 내용 정확성과 안정성을 유지
    - 종류: Oracle, SQL Server, MYSQL, PostgreSQL, MariaDB, MongoDB 등

# 관계형 데이터베이스와 MySQL

## 관계형 데이터베이스 (RDB)

- 1970년 IBM E.F.Codd에 의해 제안
- 키와 값들의 간단한 관계를 **테이블화**
- 일련의 정형화된 테이블로 구성
- **SQL**이라는 표준 질의어를 통해 데이터 조작
- 특징
    - 데이터를 **테이블** 형태로 저장한다.
    - 테이블 간의 **관계(Relationship)**를 통해 데이터를 연결한다.
    - **SQL(Structured Query Language)**로 데이터를 조작한다.
    - 데이터 무결성과 일관성을 보장한다.

## MySQL 소개

- 세계에서 가장 인기 있는 **오픈소스** 데이터베이스이다.
- 1996년 첫 공식 버전이 발표되었다.
- 2008년 SUN에서 인수하였고, 이후 Oracle이 관리한다.
- 웹 애플리케이션 개발에 널리 사용된다. (LAMP Stack)

## MySQL 버전별 차이점

- **MySQL 5.x**
    - 널리 사용되던 안정 버전
    - 기본 캐릭터셋: lation1 - JSON 타입 미지원 (5.7부터 지원)
- **MySQL 8.0 (현재 최신 LTS 버전)**
    - 기본 캐릭터셋: utf8mb4
    - CHECK 제약조건 완전 지원 (8.0.16부터)
    - 윈도우 함수 지원: 개선된 성능과 보안
    - 새로운 인증 플러그인 (caching_sha2_password)
- 버전 확인 방법
    
    ```sql
    SELECT VERSION();
    -- 또는
    SHOW VARIAbLES LIKE 'version';
    ```
    

# Docker 이해하기

## Docker란 무엇인가?

- **Docker = 프로그램을 담는 상자**
    - MySQL, Redis, MongoDB 같은 프로그램을 **컨테이너**라는 상자에 담아서 실행한다.
    - 복잡한 설치 과정 없이 명령어 하나로 실행이 가능하다.
    - 삭제도 간단하다. (컨테이너만 지우면 끝)
- **Docker를 사용하는 이유**
    - **Docker 없이 MySQL 설치**
        - 운영체제마다 다른 설치 방법
        - 환경 설정 파일 직접 수정
        - 버전 충돌, 권한 문제 등 다양한 오류
        - 삭제할 때도 여러 파일을 찾아서 제거
    - **Docker로 MySQL 설치**
        
        ```docker
        # 이 명령어 하나로 설치 완료!
        docker run -d -p 3306:3306 -e MYSQL_ROOT_PASSWORD=1234 mysql:8.0
        ```
        
        - 3306 포트를 이미 사용 중이었다면 다른 유효 포트로 변경
        - 앞쪽 포트번호: 로컬 포트 / 뒤쪽 포트번호: 컨테이너 내부에서 사용할 포트

## 꼭 알아야 할 Docker 용어 3가지

- **이미지 (Image)**
    - 프로그램이 들어있는 **설치 파일**
    - 예: `mysql:8.0` = MySQL 8.0 버전 설치 파일
- **컨테이너 (Container)**
    - 이미지를 실행한 **실제 프로그램**
    - 하나의 이미지로 여러 개의 컨테이너 실행 가능
- **Docker Hub**
    - 이미지를 다운로드하는 앱스토어
    - hub.docker.com에서 다양한 프로그램 이미지 제공

```basic
Docker Hub → 이미지 다운로드 → 컨테이너 실행
   (상점)        (설치파일)         (프로그램)
```

# Docker Desktop 설치

## Mac 설치

1. 자신의 Mac 프로세서 확인
    
    ```bash
    # 터미널에서 프로세서 종류 확인
    uname -m
    ```
    
2. `arm64`: Aplie Silicon / `x86_64`: Intel
3. https://www.docker.com/products/docker-desktop/ 에서 프로세서에 맞는 버전 다운로드
4. 다운로드된 DMG 파일 클릭
5. Docker 아이콘을 Application 폴더로 드래그
6. Applie Silicon 사용자는 Docker Desktop 설치 후 터미널에서
    
    ```bash
    softwareupdate --install-rosetta
    ```
    
    - 해당 명령으로 Rosetta 2를 설치하면 호환성이 향상된다.

## 설치 확인

1. Mac: Application에서 Docker 더블클릭
2. 시스템 트레이(우하단)에 Docker 고래 아이콘이 나타나면 성공
3. 터미널/명령 프롬프트에서 확인
    
    ```bash
    docker --version
    ```
    
    - 버전 정보가 나타나면 성공
    
    ```bash
    Docker version 28.3.3, build 980b856
    ```
    
- Docker 작동 테스트
    
    ```bash
    docker run hello-world
    ```
    
    - 성공 메시지가 나타나면 정상
    
    ```bash
    Hello from Docker!
    This message shows that your installation appears to be working correctly.
    ..
    ```
    

# docker-compose로 MySQL 실행

## docker-compose.yml 파일 작성

- 프로젝트 디렉토리를 생성하고 docker-compose.yml 파일을 작성한다.
    
    ```bash
    mkdir -p ~/LikeLion/docker/mysql
    # -p: 부모 디렉토리가 없을 경우 자동 생성
    cd ~/docker/mysql
    ```
    
- docker-compose.yml 파일 내용
    
    ```bash
    version: "3.8" # 어차피 Obsolete
    
    services:
      mysql-db:
        image: mysql:8.0
        container_name: mysql-container
        restart: always
        environment:
          MYSQL_ROOT_PASSWORD: "root1234" # 루트(최상단, 자동생성) 유저 비밀번호
          MYSQL_DATABASE: "liondb" # 기본으로 생성할 데이터베이스
          MYSQL_USER: "jaehun" # 사용할 유저이름
          MYSQL_PASSWORD: "lion1234" # 유저 비밀번호
          TZ: Asia/Seoul
        command:
          - --character-set-server=utf8mb4
          - --collation-server=utf8mb4_unicode_ci
        volumes:
          - ./database/init/:/docker-entrypoint-initdb.d/
          - ./database/datadir/:/var/lib/mysql
        platform: linux/x86_64
        ports:
          - 3306:3306 # 3306 포트 이미 사용 중이라면 다른 유효한 포트로 변경
    ```
    
    - `platform: linux/x86_64` 설정으로 모든 환경에서 동일하게 작동한다.

## MySQL 서버 실행

```docker
# MySQL 서버 시작 (백그라운드 실행)
docker-compose up -d

# 실행 중인 컨테이너 확인
docker ps

# 로그 확인
docker-compose logs
```

**수행 결과**

```docker
╭─    ~/LikeLion/docker/mysql ······································ ✔  13:45:50  ─╮
╰─ docker-compose up -d                                                                  ─╯
WARN[0000] /Users/jaehun/LikeLion/docker/mysql/docker-compose.yml: the attribute `version` is obsolete, it will be ignored, please remove it to avoid potential confusion
[+] Running 1/1
 ✔ Container mysql-container  Running                                                  0.0s
 
╭─    ~/LikeLion/docker/mysql ······································ ✔  13:46:02  ─╮
╰─ docker ps                                                                             ─╯
CONTAINER ID   IMAGE       COMMAND                   CREATED       STATUS       PORTS                                         NAMES
bcc14e39d70f   mysql:8.0   "docker-entrypoint.s…"   2 hours ago   Up 2 hours   0.0.0.0:3308->3306/tcp, [::]:3308->3306/tcp   mysql-container
```

## MySQL 서버 접속

```docker
# 컨테이너 확인
docker ps

# 컨테이너 이름으로 접속 (방법 1)
docker exec -it mysql-container mysql -uroot -proot1234

# 컨테이너 내부로 들어가서 접속 (방법 2)
docker exec -it mysql-container /bin/bash
mysql -uroot -proot1234

# 일반 사용자로 접속
docker exec -it mysql-container mysql -ulikelion -plion1234 liondb
```

**수행 결과**

```docker
╭─    ~/LikeLion/docker/mysql ······································ ✔  13:46:11  ─╮
╰─ docker exec -it mysql-container /bin/bash                                             ─╯
# docker 접속
bash-5.1# mysql -uroot -proot1234
mysql: [Warning] Using a password on the command line interface can be insecure.
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 21
Server version: 8.0.43 MySQL Community Server - GPL

Copyright (c) 2000, 2025, Oracle and/or its affiliates.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.
#mysql 접속
mysql>

```

**MySQL 프롬프트 테스트**

```sql
-- 버전 확인
SELECT VERSION(), CURRENT_DATE;

-- 데이터베이스 목록
SHOW DATABASES;

-- 현재 사용자 확인
SELECT USER();
```

**수행 결과**

```sql
mysql> select version();
+-----------+
| version() |
+-----------+
| 8.0.43    |
+-----------+
1 row in set (0.00 sec)

mysql> show databases;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| liondb             |
| mysql              |
| performance_schema |
| sys                |
+--------------------+
5 rows in set (0.03 sec)

mysql> select user();
+----------------+
| user()         |
+----------------+
| root@localhost |
+----------------+
1 row in set (0.00 sec)
```

## MySQL 서버 종료

```docker
# 서버 종료 (하기 전에 exit을 통해 터미널까지 빠져나와야 한다.)
docker-compose down

# 데이터까지 삭제하려면
docker-compose down -v
rm -rf database/

# 윈도우 디렉토리 삭제
rmdir /s /q database
```

- `database/` 폴더가 있으면 데이터가 보존된다. 폴더를 삭제하면 모든 데이터가 삭제된다.

# MySQL Workbench 설치 및 연결

## **설치**

- https://dev.mysql.com/downloads/workbench/ 접속
- 운영체제에 맞는 버전 선택 및 다운로드
- 설치 프로그램 실행

## MySQL Workbench로 연결

1. MySQL Workbench 실행
2. 새 연결 생성
3. MySQL Connections 옆의 `+` 클릭
4. Connection Name: 이름 설정
5. Hostname: 127.0.0.1 또는 localhost
6. Port: 3306 (기본, 사용 중일 경우 다른 유효한 포트)
7. 계정명과 비밀번호 입력 후 **Test Connection**
8. 성공할 경우 OK 클릭 후 연결 사용

## Workbench 기본 사용법

```sql
-- 데이터베이스 선택
USE database_name

-- 테이블 생성 예시
CREATE TABLE test_table (
	id INT AUTO_INCREMENT PRIMARY KEY,
	name VARCHAR(50),
	created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 데이터 삽입
INSERT INTO test_table (name) VALUES ('테스트');

-- 데이터 조회
SELECT * FROM test_table;
```

- Workbench의 유용한 기능
    - **ERD(Entity Relationship Diagram)** 생성
    - **데이터 Import/Export** 기능
    - **스키마 비교** 및 동기화
    - **쿼리 성능 분석**

# IntelliJ에서 Database 연결

1. Database 도구 창 열기
    1. View → Tool Windows → Database
    2. 또는 우측 Database 탭
2. 새 연결 추가
    1. `+`버튼 → Data Source → MySQL
    2. 연결 정보 입력
        1. Host: `localhost`
        2. Port: 3306 (기본, 사용 중일 경우 다른 유효한 포트)
        3. User, Password, Database 선택
        4. Driver 다운로드
        5. **Test Connection** 클릭
        6. 연결 성공 확인

# 사용자 및 권한 관리

- 사용자 생성
    
    ```sql
    -- 모든 호스트에서 접속 가능한 사용자
    CREATE USER 'user'@'%' IDENTIFIED BY 'user1234'
    
    -- 로컬에서만 접속 가능한 사용자
    CREATE USER 'user'@'localhost' IDENTIFIED BY 'user1234'
    
    -- @ 뒷부분은 접속 ip 제한 (localhost 등록 시 Host name 'localhost'로 접속 가능)
    -- identified 뒷부분은 비밀번호
    ```
    
- 데이터베이스 생성
    
    ```sql
    -- 데이터베이스 생성
    CREATE DATABASE database_name;
    
    -- 데이터베이스 삭제
    DROP DATABASE database_name;
    ```
    
- 권한 부여
    
    ```sql
    -- 특정 데이터베이스에 대한 모든 권한
    GRANT ALL PRIVILEGES ON database_name.TO 'user_name'@'%';
    GRANT ALL PRIVILEGES ON database_name.TO 'user_name'@'localhost';
    
    -- 특정 권한만 허용
    GRANT SELECT, INSERT, UPDATE ON database_name TO 'user_name'@'%';
    
    -- 모든 권한을 가진 관리자 계정
    CREATE USER 'admin_user'@'%' IDENTIFIED BY 'admin1234';
    GRANT ALL PRIVILEGES ON *.* TO 'admin_user'@'%' WITH GRANT OPTION;
    
    -- 권한 적용
    FLUSH PRIVILEGES;
    ```
    
- 사용자 확인 및 삭제
    
    ```sql
    -- 사용자 확인 (WHERE 이후로는 조건문이므로 선택)
    SELECT user, host FROM mysql.user WHERE user = 'user_name';
    
    -- 사용자 삭제
    DROP USER 'user_name'@'%';
    DROP USER 'user_name'@'localhost';
    ```
    
- 권한 취소
    
    ```sql
    -- 모든 권한 취소
    REVOKE ALL PRIVILEGES ON database_name.* FROM 'user_name'@'%';
    
    -- 특정 권한만 취소
    REVOKE INSERT, UPDATE ON database_name.* FROM 'user_name'@'%';
    
    -- 권한 적용
    FLUSH PRIVILEGES;
    ```
